<!DOCTYPE html>

<html lang="cs">
<head>
	<title>Festival Dokořán 2013</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<link rel="shortcut icon" href="favicon.ico" />
  <link rel="apple-touch-icon" href="icons/57.jpg" />
  <link rel="apple-touch-icon" sizes="114x114" href="icons/114.jpg" />
  <link rel="apple-touch-icon" sizes="72x72" href="icons/72.jpg" />
  <link rel="apple-touch-icon" sizes="144x144" href="icons/144.jpg" />
	<link href="content/dokoran.min.css" rel="stylesheet" type="text/css" />	  
	<link href="content/jquery.mobile.structure-1.3.2.min.css" rel="stylesheet" type="text/css" />
	<link href="content/dokoran.css" rel="stylesheet" type="text/css" />
	<script src="libs/cordova.js" type="text/javascript"></script>
	<script src="libs/jquery-1.10.2.min.js" type="text/javascript"></script>
	<script src="libs/jquery.mobile-1.3.2.min.js" type="text/javascript"></script>
</head>
<body>
	<div id="index" data-role="page" data-rnc-jspage="index" data-theme="a">
		<section data-role="content">
			<img id="logo" src="content/images/dokoran.png" />
			<a href="program.html" data-role="button" data-ajax="false">PROGRAM</a>
			<a href="artists.html" data-role="button" data-ajax="false">ARTISTS</a>
			<a href="map.html" data-role="button" data-ajax="false">MAPA</a>
			<a href="info.html" data-role="button" data-prefetch>INFO</a>
			<hr />
			<h2 id="praveprobiha"></h2>
			<div id="artistslist"></div>
		</section>
		<div class="credits">
    	aplikace: <a href="http://www.ostryweb.cz">Ostrý web</a>, grafika: <a href="http://www.jirichlebus.cz">Jiří Chlebus</a><br>
		</div>
	</div>
	<script src="scripts/app.js" type="text/javascript"></script>
	<script type="text/javascript">
	$(document).on('pagebeforeshow', '#index', function(){
		$.getJSON('content/data/program.json', function(data) {
		  var items = [];
		  var currenttime = new Date();
		  if (currenttime.getHours()<posledniHodinaNoci){ // od pulnoci do rana je nutne shiftnout datum, populnocni patri pod predchozi den
			currenttime.setDate(currenttime.getDate()-1);
		  }
		  
		  $.each(data.days, function(key, val) {
			var datum = parseDatum(val.date, '00:01');
			//console.log(datum.getDate() + ' =? ' +currenttime.getDate());
			if (datum.getDate()==currenttime.getDate()){
				//console.log('yes - push');
				$("#praveprobiha").append('PRÁVĚ PROBÍHÁ');
				items.push('<table cellpadding="0" cellspacing="0" border="0"><tbody><thead><tr><th scope="col">čas:</th><th scope="col">stage:</th><th scope="col">jméno:</th><th scope="col">popis:</th></tr></thead>');
				$.each(val.stages, function(key1, val1) {
					$.each(val1.artists, function(key2, val2) {
						val2.stage = val1.id; //pridavam info o stagi
						var datum = parseDatum(val.date, val2.time);
						var datum2 = new Date(datum);
						datum2.setMinutes(datum.getMinutes()+val2.duration);
						
						//console.log(currenttime + ' > ' +datum);
						//console.log(currenttime + ' < ' +datum2);
						if (currenttime>=datum && currenttime<=datum2){
							items.push('<tr class="'+val1.id+'"><td>'+val2.time+'-'+(pad(datum2.getHours())+':'+pad(datum2.getMinutes()))+'</td><td>'+val1.name+'</td><td>'+val2.name+'</td><td>'+val2.shortdesc+'</td></tr>');
						}
					});
				});
				items.push('</tbody></table>');
			}
			
		  });
		$("#artistslist").append(items.join(''));
			
			//$('#artistslist').listview('refresh');
		});
	});
    </script>
</body>
</html>
